# -*- coding: utf-8 -*-
# vim: ft=yaml
---
ssf_node_anchors:
  defaults:
    file: &file_default
      mode: 644
      template: ''
    formula:
      context:
        inspec_suites_kitchen:
          0:
            includes: &includes_NONE
              - []
            inspec_yml:
              depends_on_suite_share: &depends_on_suite_share
                - name: 'share'
                  path: 'test/integration/share'
              supports_debian_ubuntu: &supports_debian_ubuntu
                - debian
                - ubuntu
              # yamllint disable-line rule:line-length
              supports_debian_ubuntu_centos_fedora_opensuse: &supports_debian_ubuntu_centos_fedora_opensuse
                - debian
                - ubuntu
                - centos
                - fedora
                - opensuse
              supports_centos_fedora_amazon: &supports_centos_fedora_amazon
                - centos
                - fedora
                - amazon
            provisioner:
              dependencies_epel: &dependencies_epel
                - name: 'epel'
                  repo: 'git'
                  source: 'https://github.com/saltstack-formulas/epel-formula.git'
              state_top_salt: &state_top_salt
                - '*':
                    - .pkgrepo
                    - .master
                    - .minion
            verifier: &verifier_inspec_tests_default
              inspec_tests:
                - default
        platforms_osfamily_debian: &platforms_osfamily_debian
          # [os           , os_ver, salt_ver, py_ver]
          - [debian       ,  10   ,   master,      3]
          - [ubuntu       ,  18.04,   master,      3]
          - [debian       ,  10   ,   2019.2,      3]
          - [debian       ,   9   ,   2019.2,      3]
          - [ubuntu       ,  18.04,   2019.2,      3]
          - [debian       ,   9   ,   2018.3,      2]
          - [ubuntu       ,  16.04,   2018.3,      2]
          - [debian       ,   8   ,   2017.7,      2]
          - [ubuntu       ,  16.04,   2017.7,      2]
        platforms_osfamily_redhat: &platforms_osfamily_redhat
          # [os           , os_ver, salt_ver, py_ver]
          - [centos       ,   8   ,   master,      3]
          - [fedora       ,  31   ,   master,      3]
          - [amazonlinux  ,   2   ,   master,      2]
          - [centos       ,   8   ,   2019.2,      3]
          - [fedora       ,  31   ,   2019.2,      3]
          - [amazonlinux  ,   2   ,   2019.2,      2]
          - [centos       ,   7   ,   2019.2,      2]
          - [fedora       ,  30   ,   2018.3,      3]
          - [centos       ,   7   ,   2018.3,      2]
          - [amazonlinux  ,   2   ,   2018.3,      2]
          - [centos       ,   6   ,   2017.7,      2]
          - [fedora       ,  30   ,   2017.7,      2]
          - [amazonlinux  ,   2   ,   2017.7,      2]
        platforms_osfamily_suse: &platforms_osfamily_suse
          # [os           , os_ver, salt_ver, py_ver]
          - [opensuse/leap,  15.1 ,   master,      3]
          - [opensuse/leap,  15.1 ,   2019.2,      3]
          - [opensuse/leap,  15.1 ,   2018.3,      2]
          - [opensuse/leap,  15.1 ,   2017.7,      2]
        platforms_os_debian: &platforms_os_debian
          # [os           , os_ver, salt_ver, py_ver]
          - [debian       ,  10   ,   master,      3]
          - [debian       ,  10   ,   2019.2,      3]
          - [debian       ,   9   ,   2019.2,      3]
          - [debian       ,   9   ,   2018.3,      2]
          - [debian       ,   8   ,   2017.7,      2]
        platforms_os_ubuntu: &platforms_os_ubuntu
          # [os           , os_ver, salt_ver, py_ver]
          - [ubuntu       ,  18.04,   master,      3]
          - [ubuntu       ,  18.04,   2019.2,      3]
          - [ubuntu       ,  16.04,   2018.3,      2]
          - [ubuntu       ,  16.04,   2017.7,      2]
        # platforms_os_ubuntu18: &platforms_os_ubuntu18
        #   # [os           , os_ver, salt_ver, py_ver]
        #   - [ubuntu       ,  18.04,   master,      3]
        #   - [ubuntu       ,  18.04,   2019.2,      3]
        # platforms_os_ubuntu16: &platforms_os_ubuntu16
        #   # [os           , os_ver, salt_ver, py_ver]
        #   - [ubuntu       ,  16.04,   2018.3,      2]
        #   - [ubuntu       ,  16.04,   2017.7,      2]
        platforms_os_fedora: &platforms_os_fedora
          # [os           , os_ver, salt_ver, py_ver]
          - [fedora       ,  31   ,   master,      3]
          - [fedora       ,  31   ,   2019.2,      3]
          - [fedora       ,  30   ,   2018.3,      3]
          - [fedora       ,  30   ,   2017.7,      2]
        # platforms_os_suse: &platforms_os_suse
        #   # [os           , os_ver, salt_ver, py_ver]
        #   - [opensuse/leap,  15.1 ,   master,      3]
        #   - [opensuse/leap,  15.1 ,   2019.2,      3]
        #   - [opensuse/leap,  15.1 ,   2018.3,      2]
        #   - [opensuse/leap,  15.1 ,   2017.7,      2]
        platforms_os_centos: &platforms_os_centos
          # [os           , os_ver, salt_ver, py_ver]
          - [centos       ,   8   ,   master,      3]
          - [centos       ,   8   ,   2019.2,      3]
          - [centos       ,   7   ,   2019.2,      2]
          - [centos       ,   7   ,   2018.3,      2]
          - [centos       ,   6   ,   2017.7,      2]
        platforms_os_centos6: &platforms_os_centos6
          # [os           , os_ver, salt_ver, py_ver]
          - [centos       ,   6   ,   2017.7,      2]
        platforms_os_amazonlinux: &platforms_os_amazonlinux
          # [os           , os_ver, salt_ver, py_ver]
          - [amazonlinux  ,   2   ,   master,      2]
          - [amazonlinux  ,   2   ,   2019.2,      2]
          - [amazonlinux  ,   2   ,   2018.3,      2]
          - [amazonlinux  ,   2   ,   2017.7,      2]
        platforms_os_arch_base: &platforms_os_arch_base
          # [os           , os_ver, salt_ver, py_ver]
          - [arch-base    , latest,   master,      2]
          - [arch-base    , latest,   2019.2,      2]
          - [arch-base    , latest,   2018.3,      2]
          - [arch-base    , latest,   2017.7,      2]
        platforms_os_redhat_locale_specific: &platforms_os_redhat_locale_specific
          # [os           , os_ver, salt_ver, py_ver]
          - [centos       ,   8   ,   master,      3]
          - [fedora       ,  31   ,   master,      3]
          - [amazonlinux  ,   2   ,   master,      2]
          - [centos       ,   8   ,   2019.2,      3]
          - [fedora       ,  31   ,   2019.2,      3]
          - [amazonlinux  ,   2   ,   2019.2,      2]
          - [fedora       ,  30   ,   2018.3,      3]
          - [amazonlinux  ,   2   ,   2018.3,      2]
          - [fedora       ,  30   ,   2017.7,      2]
          - [amazonlinux  ,   2   ,   2017.7,      2]
        platforms_os_centos_and_arch: &platforms_os_centos_and_arch
          # [os           , os_ver, salt_ver, py_ver]
          - [centos       ,   8   ,   master,      3]
          - [arch-base    , latest,   master,      2]
          - [centos       ,   8   ,   2019.2,      3]
          - [centos       ,   7   ,   2019.2,      2]
          - [arch-base    , latest,   2019.2,      2]
          - [centos       ,   7   ,   2018.3,      2]
          - [arch-base    , latest,   2018.3,      2]
          - [centos       ,   6   ,   2017.7,      2]
          - [arch-base    , latest,   2017.7,      2]
        platforms_2017_7: &platforms_2017_7
          # [os           , os_ver, salt_ver, py_ver]
          # - [debian       ,   9   ,   2017.7,      2]
          - [debian       ,   8   ,   2017.7,      2]
          - [ubuntu       ,  16.04,   2017.7,      2]
          - [centos       ,   6   ,   2017.7,      2]
          - [fedora       ,  30   ,   2017.7,      2]
          - [opensuse/leap,  15.1 ,   2017.7,      2]
          - [amazonlinux  ,   2   ,   2017.7,      2]
          - [arch-base    , latest,   2017.7,      2]
        platforms_matrix_osfamily_suites: &platforms_matrix_osfamily_suites
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,          debian]
          - [ubuntu       ,  18.04,   2019.2,      3,          debian]
          - [amazonlinux  ,   2   ,   2019.2,      2,          redhat]
          - [fedora       ,  30   ,   2018.3,      3,          redhat]
          - [opensuse/leap,  15.1 ,   2018.3,      2,            suse]
          - [centos       ,   6   ,   2017.7,      2,          redhat]
        platforms_matrix_osfamily_debian: &platforms_matrix_osfamily_debian
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   master,      3,         default]
          - [debian       ,   9   ,   2019.2,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [debian       ,   9   ,   2018.3,      2,         default]
          - [ubuntu       ,  16.04,   2017.7,      2,         default]
        platforms_matrix_systemd_only: &platforms_matrix_systemd_only
          # TODO: Get `centos-8` working again and re-enable
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          # # - [centos       ,   8   ,   2019.2,      3,         default]
          - [opensuse/leap,  15.1 ,   2019.2,      3,         default]
          # - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [arch-base    , latest,   2018.3,      2,         default]
          # - [centos       ,   6   ,   2017.7,      2,         default]
          - [amazonlinux  ,   2   ,   2017.7,      2,         default]
        platforms_matrix_without_arch: &platforms_matrix_without_arch
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [opensuse/leap,  15.1 ,   2019.2,      3,         default]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          # - [arch-base    , latest,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
        # yamllint disable-line rule:line-length
        travis_do_not_use_single_job_for_linters: &travis_do_not_use_single_job_for_linters
          use_single_job_for_linters: false
        yamllint:
          rules:
            rule:
              ignore_pillar_example: &ignore_pillar_example
                - pillar.example
              # yamllint disable-line rule:line-length
              ignore_pillar_example_and_with_views_example: &ignore_pillar_example_and_with_views_example
                - pillar.example
                - pillar-with-views.example
      semrel_files: &semrel_files_default
        bin/kitchen: &file__bin__kitchen
          <<: *file_default
          mode: 755
        docs/CONTRIBUTING.rst: &file__docs__CONTRIBUTING--rst
          <<: *file_default
        docs/TOFS_pattern.rst: &file__docs__TOFS_pattern--rst
          <<: *file_default
        formula/libtofs.jinja: &file__formula__libtofs--jinja
          <<: *file_default
        inspec/inspec.yml: &file__inspec__inspec--yml
          <<: *file_default
          template: 'jinja'
        inspec/README.md: &file__inspec__README--md
          <<: *file_default
          template: 'jinja'
        .gitignore: &file__--gitignore
          <<: *file_default
        .cirrus.yml: &file__--cirrus--yml
          <<: *file_default
          template: 'jinja'
        .rubocop.yml: &file__--rubocop--yml
          <<: *file_default
          template: 'jinja'
        .salt-lint: &file__--salt-lint
          <<: *file_default
          template: 'jinja'
        .travis.yml: &file__--travis--yml
          <<: *file_default
          template: 'jinja'
        .yamllint: &file__--yamllint
          <<: *file_default
          template: 'jinja'
        commitlint.config.js: &file__commitlint--config--js
          <<: *file_default
        Gemfile: &file__Gemfile
          <<: *file_default
        kitchen.yml: &file__kitchen--yml
          <<: *file_default
          template: 'jinja'
        pre-commit_semantic-release.sh: &file__pre-commit_semantic-release--sh
          <<: *file_default
          mode: 755
        release-rules.js: &file__release-rules--js
          <<: *file_default
        release.config.js: &file__release--config--js
          <<: *file_default

ssf:
  semrel_formulas:
    apache:
      context:
        git:
          github:
            repo: 'apache-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the apache formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
              state_top:
                - '*':
                    - .
                    - .mod_security
        platforms_matrix:
          # Comments in `platforms` apply here, too
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          # - [arch-base    , latest,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          # - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    apt:
      context:
        git:
          github:
            repo: 'apt-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the apt repositories are configured correctly
              supports: *supports_debian_ubuntu
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/repositories.pillar.sls'
              state_top:
                - '*':
                    - .repositories
                    - .update
          1:
            inspec_yml:
              summary: >-
                Verify that the apt preferences are configured correctly
              supports: *supports_debian_ubuntu
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/preferences.pillar.sls'
              state_top:
                - '*':
                    - .preferences
        inspec_suites_matrix:
          - repositories
          - preferences
        platforms:
          # [os           , os_ver, salt_ver, py_ver]
          - [debian       ,  10   ,   master,      3]
          - [ubuntu       ,  18.04,   master,      3]
          # - [debian       ,  10   ,   2019.2,      3]
          - [debian       ,   9   ,   2019.2,      3]
          - [ubuntu       ,  18.04,   2019.2,      3]
          # - [debian       ,   9   ,   2018.3,      2]
          # - [ubuntu       ,  16.04,   2018.3,      2]
          # - [debian       ,   8   ,   2017.7,      2]
          # - [ubuntu       ,  16.04,   2017.7,      2]
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,    repositories]
          # - [ubuntu       ,  18.04,   master,      3,    repositories]
          - [debian       ,   9   ,   2019.2,      3,    repositories]
          - [ubuntu       ,  18.04,   2019.2,      3,    repositories]
          - [debian       ,  10   ,   master,      3,     preferences]
          # - [ubuntu       ,  18.04,   master,      3,     preferences]
          - [debian       ,   9   ,   2019.2,      3,     preferences]
          - [ubuntu       ,  18.04,   2019.2,      3,     preferences]
        rubocop:
          Cops:
            Metrics/BlockLength:
              Max: 55
      semrel_files: *semrel_files_default
    apt-cacher:
      context:
        git:
          github:
            repo: 'apt-cacher-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the apt-cacher formula is setup and configured correctly
              supports: *supports_debian_ubuntu
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/apt-cacher.sls'
              state_top:
                - '*':
                    - .ng.server
                    - .ng.client
        platforms_matrix: *platforms_matrix_osfamily_debian
        use_tofs: true
      semrel_files:
        <<: *semrel_files_default
        formula/libtofs.jinja:
          <<: *file__formula__libtofs--jinja
          dest_file: 'formula/ng/libtofs.jinja'
    bind:
      context:
        git:
          github:
            repo: 'bind-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the bind formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
              state_top:
                - '*':
                    - .
                    - .config
        platforms_matrix: *platforms_matrix_without_arch
        travis: *travis_do_not_use_single_job_for_linters
        yamllint:
          rules:
            comments-indentation:
              ignore: *ignore_pillar_example_and_with_views_example
            key-duplicates:
              ignore: *ignore_pillar_example
            line-length:
              ignore: *ignore_pillar_example_and_with_views_example
      semrel_files: *semrel_files_default
    cert:
      context:
        git:
          github:
            repo: 'cert-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the cert formula is setup and configured correctly
            provisioner:
              dependencies:
                - name: 'files'
                  path: './test/salt'
                - name: 'states'
                  path: './test/salt'
              pillars_from_files:
                - .sls: 'test/salt/pillar/managed.sls'
              state_top:
                - '*':
                    - states/setup-certs-to-remove
                    - .
        travis: *travis_do_not_use_single_job_for_linters
      semrel_files: *semrel_files_default
    chrony:
      context:
        git:
          github:
            repo: 'chrony-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the chrony formula is setup and configured correctly
        use_tofs: true
      semrel_files: *semrel_files_default
    collectd:
      context:
        git:
          github:
            repo: 'collectd-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the collectd formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/default/pillar/collectd.sls'
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [centos       ,   8   ,   2019.2,      3,         default]
          # - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          # - [arch-base    , latest,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    cron:
      context:
        git:
          github:
            repo: 'cron-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the cron formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/cron.sls'
      semrel_files: *semrel_files_default
    deepsea:
      context:
        git:
          github:
            repo: 'deepsea-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the deepsea formula is setup and configured correctly
        platforms_matrix:
          # Note, keeping this "working out" because difficult to resolve for this repo
          # One `#` where working but not using, two `# #` for not working at all
          # Update: the lines the have been modified due to `2019.2.2` can no longer
          #         be guaranteed (i.e. working or not)
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          # # - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   master,      3,         default]
          # - [centos       ,   8   ,   master,      3,         default]
          # - [fedora       ,  31   ,   master,      3,         default]
          # - [opensuse/leap,  15.1 ,   master,      3,         default]
          # # - [Amazonlinux  ,   2   ,   master,      2,         default]
          # # - [arch-base    , latest,   master,      2,         default]
          - [debian       ,  10   ,   2019.2,      3,         default]  # CHECK
          - [debian       ,   9   ,   2019.2,      3,         default]
          # - [ubuntu       ,  18.04,   2019.2,      3,         default]
          # - [centos       ,   8   ,   2019.2,      3,         default]
          # # - [fedora       ,  31   ,   2019.2,      3,         default]
          # # - [opensuse/leap,  15.1 ,   2019.2,      3,         default]
          # # - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          # - [centos       ,   7   ,   2019.2,      2,         default]
          # # - [arch-base    , latest,   2019.2,      2,         default]
          # - [fedora       ,  30   ,   2018.3,      3,         default]
          # # - [debian       ,   9   ,   2018.3,      2,         default]
          # # - [ubuntu       ,  16.04,   2018.3,      2,         default]
          - [centos       ,   7   ,   2018.3,      2,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          # # - [amazonlinux  ,   2   ,   2018.3,      2,         default]
          # # - [arch-base    , latest,   2018.3,      2,         default]
          # # - [debian       ,   8   ,   2017.7,      2,         default]
          # # - [ubuntu       ,  16.04,   2017.7,      2,         default]
          # # - [centos       ,   6   ,   2017.7,      2,         default]
          - [fedora       ,  30   ,   2017.7,      2,         default]
          # - [opensuse/leap,  15.1 ,   2017.7,      2,         default]
          # # - [amazonlinux  ,   2   ,   2017.7,      2,         default]
          # # - [arch-base    , latest,   2017.7,      2,         default]
        use_tofs: true
      semrel_files: *semrel_files_default
    dhcpd:
      context:
        git:
          github:
            repo: 'dhcpd-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the dhcpd formula is setup and configured correctly
            provisioner:
              state_top:
                - '*':
                    - .config
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          # - [arch-base    , latest,   2019.2,      2,         default]
          # - [fedora       ,  30   ,   2018.3,      3,         default]
          - [centos       ,   7   ,   2018.3,      2,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
        travis: *travis_do_not_use_single_job_for_linters
      semrel_files: *semrel_files_default
    django:
      context:
        git:
          github:
            repo: 'django-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the django formula is setup and configured correctly
            provisioner:
              state_top:
                - '*':
                    - .pip
      semrel_files: *semrel_files_default
    docker:
      context:
        git:
          github:
            repo: 'docker-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the docker formula is setup and configured correctly
            provisioner:
              state_top:
                - '*':
                    - .
                    - .containers
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [debian       ,   9   ,   2019.2,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [arch-base    , latest,   2019.2,      2,         default]
          - [debian       ,   9   ,   2018.3,      2,         default]
          - [ubuntu       ,  16.04,   2017.7,      2,         default]
        yamllint:
          ignore:
            additional:
              - docker/osfamilymap.yaml
      semrel_files: *semrel_files_default
    epel:
      context:
        git:
          github:
            repo: 'epel-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the epel formula is setup and configured correctly
              supports: *supports_centos_fedora_amazon
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
        platforms:
          # Later, consider using for all *platforms_osfamily_redhat
          # [os           , os_ver, salt_ver, py_ver]
          - [amazonlinux  ,   1   ,   master,      2]
          - [centos       ,   8   ,   master,      3]
          - [fedora       ,  31   ,   master,      3]
          - [amazonlinux  ,   2   ,   master,      2]
          - [amazonlinux  ,   1   ,   2019.2,      2]
          - [centos       ,   8   ,   2019.2,      3]
          - [fedora       ,  31   ,   2019.2,      3]
          - [amazonlinux  ,   2   ,   2019.2,      2]
          - [centos       ,   7   ,   2019.2,      2]
          - [amazonlinux  ,   1   ,   2018.3,      2]
          - [fedora       ,  30   ,   2018.3,      3]
          - [centos       ,   7   ,   2018.3,      2]
          - [amazonlinux  ,   2   ,   2018.3,      2]
          - [amazonlinux  ,   1   ,   2017.7,      2]
          - [centos       ,   6   ,   2017.7,      2]
          - [fedora       ,  30   ,   2017.7,      2]
          - [amazonlinux  ,   2   ,   2017.7,      2]
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [centos       ,   8   ,   master,      3,         default]
          # - [fedora       ,  31   ,   master,      3,         default]
          - [amazonlinux  ,   1   ,   2019.2,      2,         default]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          - [centos       ,   7   ,   2019.2,      2,         default]
          # - [fedora       ,  30   ,   2018.3,      3,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    exim:
      context:
        git:
          github:
            repo: 'exim-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the exim formula is setup and configured correctly
              supports: *supports_debian_ubuntu
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/exim.sls'
        platforms_matrix: *platforms_matrix_osfamily_debian
        use_tofs: true
      semrel_files: *semrel_files_default
    fail2ban:
      context:
        git:
          github:
            repo: 'fail2ban-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the fail2ban formula is setup and configured correctly
            provisioner:
              dependencies:
                - name: 'misc'
                  path: 'test/salt/states'
              state_top:
                - '*':
                    - misc.fake_log_files
                    - .
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          # - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          - [arch-base    , latest,   2019.2,      2,         default]
          - [fedora       ,  31   ,   2019.2,      3,         default]
          # - [fedora       ,  30   ,   2018.3,      3,         default]
          - [centos       ,   7   ,   2018.3,      2,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    firewalld:
      context:
        git:
          github:
            repo: 'firewalld-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the firewalld formula is setup and configured correctly
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [ubuntu       ,  18.04,   master,      3,         default]
          - [debian       ,   9   ,   2019.2,      3,         default]
          - [opensuse/leap,  15.1 ,   2019.2,      3,         default]
          - [amazonlinux  ,   2   ,   2018.3,      2,         default]
          - [ubuntu       ,  16.04,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    golang:
      context:
        git:
          github:
            repo: 'golang-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the golang formula is setup and configured correctly
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          # - [arch-base    , latest,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [debian       ,   9   ,   2018.3,      2,         default]
          # - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
        travis: *travis_do_not_use_single_job_for_linters
        use_tofs: true
      semrel_files: *semrel_files_default
    grafana:
      context:
        git:
          github:
            repo: 'grafana-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the grafana formula is setup and configured correctly
        platforms_matrix: *platforms_matrix_osfamily_debian
        travis: *travis_do_not_use_single_job_for_linters
        use_tofs: true
      semrel_files: *semrel_files_default
    influxdb:
      context:
        git:
          github:
            repo: 'influxdb-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the influxdb formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/influxdb.sls'
        platforms_matrix: *platforms_matrix_without_arch
      semrel_files: *semrel_files_default
    iptables:
      context:
        git:
          github:
            repo: 'iptables-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that iptables is installed and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.pillar.sls'
          1:
            inspec_yml:
              summary: >-
                Verify that iptables is installed and configured using tables defined
                in pillars
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/tables.pillar.sls'
              state_top:
                - '*':
                    - .
                    - .tables
        inspec_suites_matrix:
          - default
          - tables
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          - [arch-base    , latest,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [centos       ,   7   ,   2018.3,      2,         default]
          # - [centos       ,   6   ,   2017.7,      2,         default]
          - [opensuse/leap,  15.1 ,   2017.7,      2,          tables]
        travis: *travis_do_not_use_single_job_for_linters
        yamllint:
          rules:
            key-duplicates:
              ignore: *ignore_pillar_example
      semrel_files: *semrel_files_default
    iscsi:
      context:
        git:
          github:
            repo: 'iscsi-formula'
        inspec_suites_kitchen:
          0:
            excludes: *platforms_os_centos_and_arch
            inspec_yml:
              summary: >-
                Verify that the iscsi formula is setup and configured correctly
            provisioner:
              dependencies:
                - name: 'lvm'
                  repo: 'git'
                  source: 'https://github.com/saltstack-formulas/lvm-formula.git'
              pillars:
                - '*':
                    - lvm
                    - .
              pillars_from_files:
                - lvm.sls: 'test/salt/pillar/lvm.example'
                - .sls: 'test/salt/pillar/pillar.example'
              state_top:
                - '*':
                    - lvm.install
                    - lvm.files.create
                    - lvm.pv.create
                    - .
                    - .clean
          1:
            includes: *platforms_os_centos_and_arch
            provisioner:
              dependencies:
                - name: 'users'
                  repo: 'git'
                  source: 'https://github.com/saltstack-formulas/users-formula.git'
                - name: 'lvm'
                  repo: 'git'
                  source: 'https://github.com/saltstack-formulas/lvm-formula.git'
              pillars:
                - '*':
                    - users
                    - lvm
                    - .
              pillars_from_files:
                - users.sls: 'test/salt/pillar/users.arch'
                - lvm.sls: 'test/salt/pillar/lvm.example'
                - .sls: 'test/salt/pillar/pillar.travis'
              state_top:
                - '*':
                    - users
                    - lvm.install
                    - lvm.files.create
                    - lvm.pv.create
                    - .
                    - .clean
            verifier: *verifier_inspec_tests_default
        inspec_suites_matrix:
          - default
          - centarch
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          # # - [centos       ,   8   ,   master,      3,        centarch]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          # # - [centos       ,   8   ,   2019.2,      3,        centarch]
          - [opensuse/leap,  15.1 ,   2019.2,      3,         default]
          - [arch-base    , latest,   2019.2,      2,        centarch]
          - [amazonlinux  ,   2   ,   2018.3,      2,         default]
        use_tofs: true
        yamllint:
          ignore:
            additional:
              - iscsi/oscodename.yaml
          yaml-files:
            additional:
              - '*.arch'
      semrel_files: *semrel_files_default
    keepalived:
      context:
        git:
          github:
            repo: 'keepalived-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the keepalived formula is setup and configured correctly
        script_kitchen:
          pre:
            - sudo modprobe ip_vs
        travis:
          addons:
            apt:
              packages:
                - ipvsadm
        use_tofs: true
      semrel_files: *semrel_files_default
    letsencrypt:
      context:
        git:
          github:
            repo: 'letsencrypt-formula'
        inspec_suites_kitchen:
          0:
            # `2017.7` don't have the `git.cloned` state so will have to use one of
            # the other suites
            excludes: *platforms_2017_7
            inspec_yml:
              summary: >-
                Verify that the letsencrypt formula is setup and configured correctly
                using `git`
            provisioner:
              pillars:
                - '*':
                    - .
              pillars_from_files:
                - .sls: 'test/salt/pillar/git.sls'
              state_top:
                - '*':
                    - .install
                    - .config
          1:
            includes: *platforms_os_debian
            inspec_yml:
              summary: >-
                Verify that the letsencrypt formula is setup and configured correctly
                on Debian
            provisioner:
              dependencies:
                - name: 'apt'
                  repo: 'git'
                  source: 'https://github.com/saltstack-formulas/apt-formula.git'
              pillars:
                - '*':
                    - apt
                    - .
              pillars_from_files:
                - apt.sls: 'test/salt/pillar/apt.sls'
                - .sls: 'test/salt/pillar/deb.sls'
              state_top:
                - '*':
                    - apt.repositories
                    - apt.preferences
                    - apt.update
                    - .install
                    - .config
          2:
            includes: *platforms_osfamily_redhat
            inspec_yml:
              summary: >-
                Verify that the letsencrypt formula is setup and configured correctly
                on RedHat (and derivatives)
            provisioner:
              pillars:
                - '*':
                    - .
              pillars_from_files:
                - .sls: 'test/salt/pillar/rpm.sls'
              state_top:
                - '*':
                    - .install
                    - .config
        inspec_suites_matrix:
          - git
          - deb
          - rpm
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,             deb]
          - [ubuntu       ,  18.04,   2019.2,      3,             git]
          - [centos       ,   8   ,   2019.2,      3,             git]
          - [arch-base    , latest,   2019.2,      2,             git]
          - [fedora       ,  30   ,   2018.3,      3,             git]
          - [opensuse/leap,  15.1 ,   2018.3,      2,             git]
          - [amazonlinux  ,   2   ,   2017.7,      2,             rpm]
      semrel_files: *semrel_files_default
    libvirt:
      context:
        git:
          github:
            repo: 'libvirt-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              depends: *depends_on_suite_share
              summary: >-
                Verify that the libvirt formula is setup and configured correctly
              supports: *supports_debian_ubuntu_centos_fedora_opensuse
          1:
            includes: *includes_NONE
            inspec_yml:
              summary: >-
                shared resources
              supports: *supports_debian_ubuntu_centos_fedora_opensuse
          2:
            includes:
              # [os           , os_ver, salt_ver, py_ver]
              - [debian       ,  10   ,   master,      3]
            inspec_yml:
              depends: *depends_on_suite_share
              summary: >-
                Verify that the libvirt formula can cleanup correctly
              supports: *supports_debian_ubuntu_centos_fedora_opensuse
            provisioner:
              state_top:
                - '*':
                    - .
                    - .clean
        inspec_suites_matrix:
          - default
          - share
          - clean
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [debian       ,  10   ,   master,      3,           clean]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          # - [fedora       ,  31   ,   2019.2,      3,         default]
          - [opensuse/leap,  15.1 ,   2019.2,      3,         default]
          # - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          # - [arch-base    , latest,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [centos       ,   7   ,   2018.3,      2,         default]
          - [fedora       ,  30   ,   2017.7,      2,         default]
          # - [centos       ,   6   ,   2017.7,      2,         default]
        use_tofs: true
      semrel_files: *semrel_files_default
    locale:
      context:
        git:
          github:
            repo: 'locale-formula'
        inspec_suites_kitchen:
          0:
            excludes: *platforms_os_redhat_locale_specific
            inspec_yml:
              summary: >-
                Verify that the locale formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
          1:
            includes: *platforms_os_redhat_locale_specific
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/redhat.sls'
            verifier: *verifier_inspec_tests_default
        inspec_suites_matrix:
          - default
          - redhat
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [fedora       ,  31   ,   2019.2,      3,          redhat]
          - [opensuse/leap,  15.1 ,   2019.2,      3,         default]
          - [amazonlinux  ,   2   ,   2018.3,      2,          redhat]
          - [arch-base    , latest,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    logrotate:
      context:
        git:
          github:
            repo: 'logrotate-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the logrotate formula is setup and configured correctly
            provisioner:
              dependencies:
                - name: 'states'
                  path: './test/salt'
              state_top:
                - 'G@os_family:Suse':
                    - states.cron
                - '*':
                    - .
                    - .jobs
        platforms_matrix: *platforms_matrix_without_arch
      semrel_files: *semrel_files_default
    lvm:
      context:
        git:
          github:
            repo: 'lvm-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the lvm formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/pillar.example'
              state_top:
                - '*':
                    - .clean
                    - .
        platforms_matrix:
          # Note, the commented lines are the only ones that didn't work
          # Everything else working, even if lines have been removed
          # Keeping hold of this "working out" for future reference
          # One `#` where working but not using, two `# #` for not working at all
          # Update: the lines the have been modified due to `2019.2.2` can no longer
          #         be guaranteed (i.e. working or not)
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          # - [amazonlinux  ,   2   ,   master,      2,         default]
          # # - [arch-base    , latest,   master,      2,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          # # - [fedora       ,  31   ,   2019.2,      3,         default]
          # - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          # # - [arch-base    , latest,   2019.2,      2,         default]
          # # - [centos       ,   7   ,   2018.3,      2,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          # # - [arch-base    , latest,   2018.3,      2,         default]
          # - [centos       ,   6   ,   2017.7,      2,         default]
          - [amazonlinux  ,   2   ,   2017.7,      2,         default]
          # # - [arch-base    , latest,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    mongodb:
      context:
        git:
          github:
            repo: 'mongodb-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the mongodb formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
        platforms_matrix: *platforms_matrix_osfamily_debian
        yamllint:
          ignore:
            additional:
              - mongodb/oscodemap.yaml
              - mongodb/osmap.yaml
          rules:
            key-duplicates:
              ignore: *ignore_pillar_example
      semrel_files: *semrel_files_default
    mysql:
      context:
        git:
          github:
            repo: 'mysql-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the mysql formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/mysql.sls'
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   master,      3,         default]
          - [debian       ,   9   ,   2019.2,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [debian       ,   9   ,   2018.3,      2,         default]
          - [debian       ,   8   ,   2017.7,      2,         default]
        yamllint:
          ignore:
            additional:
              - mysql/supported_sections.yaml
      semrel_files: *semrel_files_default
    nfs:
      context:
        git:
          github:
            repo: 'nfs-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the nfs formula is setup and configured correctly
            provisioner:
              state_top:
                - '*':
                    - .server
        # Based on `platforms_matrix_systemd_only`,
        # simply because `centos-6` not working
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [centos       ,   8   ,   2019.2,      3,         default]
          - [opensuse/leap,  15.1 ,   2019.2,      3,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [arch-base    , latest,   2018.3,      2,         default]
          - [amazonlinux  ,   2   ,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    nginx:
      context:
        git:
          github:
            repo: 'nginx-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the nginx formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/default/pillar/nginx.sls'
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [centos       ,   8   ,   2019.2,      3,         default]
          # - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          - [arch-base    , latest,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
        travis: *travis_do_not_use_single_job_for_linters
        use_tofs: true
      semrel_files: *semrel_files_default
    ntp:
      context:
        git:
          github:
            repo: 'ntp-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the ntp formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
              state_top:
                - '*':
                    - .ng
        yamllint:
          rules:
            key-duplicates:
              ignore: *ignore_pillar_example
      semrel_files: *semrel_files_default
    openssh:
      context:
        git:
          github:
            repo: 'openssh-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the openssh formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
              state_top:
                - '*':
                    - .config
        platforms_matrix: *platforms_matrix_without_arch
        travis: *travis_do_not_use_single_job_for_linters
        use_tofs: true
      semrel_files: *semrel_files_default
    openvpn:
      context:
        git:
          github:
            repo: 'openvpn-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the openvpn formula is setup and configured correctly
              supports:
                - debian
                - ubuntu
                - centos
                - fedora
                - opensuse
                - suse
                - freebsd
                - amazon
                - arch
                - windows
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
              state_top:
                - '*':
                    - .config
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          # - [arch-base    , latest,   2019.2,      2,         default]
          # - [fedora       ,  30   ,   2018.3,      3,         default]
          - [centos       ,   7   ,   2018.3,      2,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
        rubocop:
          Cops:
            Metrics/BlockLength:
              Max: 36
        yamllint:
          ignore:
            additional:
              - test/salt/pillar/default.sls
      semrel_files: *semrel_files_default
    # TODO:
    # 1. test/salt/pillar/pillar.example.ubuntu.1604 -- not used?
    packages:
      context:
        git:
          github:
            repo: 'packages-formula'
        inspec_suites_kitchen:
          0:
            # None of the platforms use `default` directly
            includes: *includes_NONE
            inspec_yml:
              summary: >-
                Verify that the packages formula is setup and configured correctly
            provisioner:
              pillars_from_files: []
          1:
            includes: *platforms_os_debian
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/debian.sls'
            verifier: *verifier_inspec_tests_default
          2:
            includes: *platforms_os_ubuntu
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/ubuntu1804.sls'
            verifier: *verifier_inspec_tests_default
          3:
            includes: *platforms_os_fedora
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/fedora.sls'
            verifier: *verifier_inspec_tests_default
          4:
            includes: *platforms_os_centos
            provisioner:
              dependencies: *dependencies_epel
              pillars_from_files:
                - .sls: 'test/salt/pillar/redhat.sls'
              state_top:
                - '*':
                    - epel
                    - .
            verifier: *verifier_inspec_tests_default
          5:
            includes: *platforms_os_amazonlinux
            provisioner:
              dependencies: *dependencies_epel
              pillars_from_files:
                - .sls: 'test/salt/pillar/amazon.sls'
              state_top:
                - '*':
                    - epel
                    - .
            verifier: *verifier_inspec_tests_default
          6:
            includes: *platforms_osfamily_suse
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/opensuse.sls'
            verifier: *verifier_inspec_tests_default
          7:
            includes: *platforms_os_arch_base
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/arch.sls'
            verifier: *verifier_inspec_tests_default
        inspec_suites_matrix:
          - default
          - debian
          - ubuntu
          - fedora
          - centos
          - amazon
          - suse
          - arch
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,          debian]
          - [ubuntu       ,  18.04,   2019.2,      3,          ubuntu]
          - [opensuse/leap,  15.1 ,   2019.2,      3,            suse]
          - [amazonlinux  ,   2   ,   2019.2,      2,          amazon]
          - [fedora       ,  30   ,   2018.3,      3,          fedora]
          - [centos       ,   7   ,   2018.3,      2,          centos]
          - [arch-base    , latest,   2017.7,      2,            arch]
      semrel_files: *semrel_files_default
    php:
      context:
        git:
          github:
            repo: 'php-formula'
        inspec_suites_kitchen:
          0:
            # None of the platforms use `default` directly
            includes: *includes_NONE
            inspec_yml:
              summary: >-
                Verify that the php formula is setup and configured correctly
            provisioner:
              pillars_from_files: []
          1:
            includes: *platforms_os_debian
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/debian.sls'
              state_top:
                - '*':
                    - .repo
                    - .fpm.install
                    - .fpm.config
                    - .fpm.pools
                    - .modules
                    - .fpm.service
            verifier: *verifier_inspec_tests_default
          2:
            includes: *platforms_os_ubuntu
            provisioner:
              pillars:
                - '*':
                    - .
                    - ubuntu
              pillars_from_files:
                - .sls: 'test/salt/pillar/debian.sls'
                - ubuntu.sls: 'test/salt/pillar/ubuntu.sls'
              state_top:
                - '*':
                    - .repo
                    - .fpm.install
                    - .fpm.config
                    - .fpm.pools
                    - .modules
                    - .fpm.service
            verifier: *verifier_inspec_tests_default
          3:
            includes: *platforms_osfamily_redhat
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/redhat.sls'
            verifier: *verifier_inspec_tests_default
          4:
            includes: *platforms_osfamily_suse
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/suse.sls'
            verifier: *verifier_inspec_tests_default
        inspec_suites_matrix:
          - default
          - debian
          - ubuntu
          - redhat
          - suse
        platforms_matrix:
          - [debian       ,  10   ,   master,      3,       debian]
          - [ubuntu       ,  18.04,   2019.2,      3,       ubuntu]
          - [amazonlinux  ,   2   ,   2019.2,      2,       redhat]
          - [fedora       ,  30   ,   2018.3,      3,       redhat]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         suse]
          - [centos       ,   6   ,   2017.7,      2,       redhat]
        travis: *travis_do_not_use_single_job_for_linters
        use_tofs: true
      semrel_files: *semrel_files_default
    postfix:
      context:
        git:
          github:
            repo: 'postfix-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the postfix formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
              state_top:
                - '*':
                    - .
                    - .config
        yamllint:
          rules:
            key-duplicates:
              ignore: *ignore_pillar_example
      semrel_files: *semrel_files_default
    postgres:
      context:
        git:
          github:
            repo: 'postgres-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the postgres formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/postgres.sls'
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [centos       ,   8   ,   2019.2,      3,         default]
          - [fedora       ,  31   ,   2019.2,      3,         default]
          # - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          # - [arch-base    , latest,   2019.2,      2,         default]
          - [ubuntu       ,  16.04,   2018.3,      2,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
        use_tofs: true
        yamllint:
          ignore:
            additional:
              - pillar.example
              - postgres/codenamemap.yaml
              - postgres/osfamilymap.yaml
              - postgres/osmap.yaml
              - postgres/repo.yaml
              - test/salt/pillar/postgres.sls
      semrel_files: *semrel_files_default
    prometheus:
      context:
        git:
          github:
            repo: 'prometheus-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the prometheus formula is setup and configured correctly
        platforms_matrix: *platforms_matrix_osfamily_debian
        travis: *travis_do_not_use_single_job_for_linters
        use_tofs: true
      semrel_files: *semrel_files_default
    rabbitmq:
      context:
        git:
          github:
            repo: 'rabbitmq-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the rabbitmq formula is setup and configured correctly
          1:
            provisioner:
              state_top:
                - '*':
                    - .latest
            verifier: *verifier_inspec_tests_default
        inspec_suites_matrix:
          - default
          - latest
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,          latest]
          - [ubuntu       ,  18.04,   master,      3,         default]
          - [debian       ,   9   ,   2019.2,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [debian       ,   9   ,   2018.3,      2,         default]
          - [ubuntu       ,  16.04,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    redis:
      context:
        git:
          github:
            repo: 'redis-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the redis formula is setup and configured correctly
            provisioner:
              state_top:
                - '*':
                    - .
                    - .server
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [centos       ,   8   ,   2019.2,      3,         default]
          - [fedora       ,  31   ,   2019.2,      3,         default]
          # - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          # - [arch-base    , latest,   2019.2,      2,         default]
          - [debian       ,   9   ,   2018.3,      2,         default]
          - [ubuntu       ,  16.04,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    rkhunter:
      context:
        git:
          github:
            repo: 'rkhunter-formula'
        inspec_suites_kitchen:
          0:
            # None of the platforms use `default` directly
            includes: *includes_NONE
            inspec_yml:
              summary: >-
                Verify that the rkhunter formula is setup and configured correctly
            provisioner:
              pillars_from_files: []
          1:
            includes: *platforms_osfamily_debian
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/debian.sls'
            verifier: *verifier_inspec_tests_default
          2:
            includes: *platforms_osfamily_redhat
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/redhat.sls'
            verifier: *verifier_inspec_tests_default
          3:
            includes: *platforms_osfamily_suse
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/suse.sls'
            verifier: *verifier_inspec_tests_default
        inspec_suites_matrix:
          - default
          - debian
          - redhat
          - suse
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,          debian]
          - [ubuntu       ,  18.04,   2019.2,      3,          debian]
          - [centos       ,   8   ,   2019.2,      3,          redhat]
          - [fedora       ,  30   ,   2018.3,      3,          redhat]
          - [opensuse/leap,  15.1 ,   2018.3,      2,            suse]
          - [centos       ,   6   ,   2017.7,      2,          redhat]
        travis: *travis_do_not_use_single_job_for_linters
        use_cirrus_ci: true
        use_tofs: true
      semrel_files: *semrel_files_default
    salt:
      context:
        git:
          github:
            repo: 'salt-formula'
        inspec_suites_kitchen:
          0:
            includes:
              # [os           , os_ver, salt_ver, py_ver]
              - [debian       ,  10   ,   2019.2,      3]
              - [debian       ,   9   ,   2019.2,      3]
              - [ubuntu       ,  18.04,   2019.2,      3]
              - [centos       ,   8   ,   2019.2,      3]
              # - [fedora       ,  31   ,   2019.2,      3]
              - [opensuse/leap,  15.1 ,   2019.2,      3]
            inspec_yml:
              summary: >-
                Verify that Salt `v201902-py3` is setup and configured
            provisioner:
              pillars:
                - '*':
                    - .
                    - v201902-py3
              pillars_from_files:
                - .sls: 'test/salt/pillar/salt.sls'
                - v201902-py3.sls: 'test/salt/pillar/v201902-py3.sls'
              state_top: *state_top_salt
          1:
            includes:
              # [os           , os_ver, salt_ver, py_ver]
              - [ubuntu       ,  18.04,   2019.2,      2]
              - [centos       ,   7   ,   2019.2,      2]
              - [amazonlinux  ,   2   ,   2019.2,      2]
              - [arch-base    , latest,   2019.2,      2]
            inspec_yml:
              summary: >-
                Verify that Salt `v201902-py2` is setup and configured
            provisioner:
              pillars:
                - '*':
                    - .
                    - v201902-py2
              pillars_from_files:
                - .sls: 'test/salt/pillar/salt.sls'
                - v201902-py2.sls: 'test/salt/pillar/v201902-py2.sls'
              state_top: *state_top_salt
          2:
            includes:
              # [os           , os_ver, salt_ver, py_ver]
              - [debian       ,   9   ,   2018.3,      2]
              - [ubuntu       ,  16.04,   2018.3,      2]
              - [centos       ,   7   ,   2018.3,      2]
              # - [opensuse/leap,  15.1 ,   2018.3,      2]
              - [amazonlinux  ,   2   ,   2018.3,      2]
              - [arch-base    , latest,   2018.3,      2]
            inspec_yml:
              summary: >-
                Verify that Salt `v201803-py2` is setup and configured
            provisioner:
              pillars:
                - '*':
                    - .
                    - v201803-py2
              pillars_from_files:
                - .sls: 'test/salt/pillar/salt.sls'
                - v201803-py2.sls: 'test/salt/pillar/v201803-py2.sls'
              state_top: *state_top_salt
          3:
            includes:
              # [os           , os_ver, salt_ver, py_ver]
              - [debian       ,   8   ,   2017.7,      2]
              - [ubuntu       ,  16.04,   2017.7,      2]
              - [centos       ,   6   ,   2017.7,      2]
              # Would need a forced version, Fedora could be pinned to `minor`, though
              # - [fedora       ,  30   ,   2017.7,      2]
              # - [opensuse/leap,  15.1 ,   2017.7,      2]
              - [amazonlinux  ,   2   ,   2017.7,      2]
              - [arch-base    , latest,   2017.7,      2]
            inspec_yml:
              summary: >-
                Verify that Salt `v201707-py2` is setup and configured
            provisioner:
              pillars:
                - '*':
                    - .
                    - v201707-py2
              pillars_from_files:
                - .sls: 'test/salt/pillar/salt.sls'
                - v201707-py2.sls: 'test/salt/pillar/v201707-py2.sls'
              state_top: *state_top_salt
        inspec_suites_matrix:
          - v201902-py3
          - v201902-py2
          - v201803-py2
          - v201707-py2
        # "Reversed" the ordering here to get the slowest instances closer to the top
        platforms:
          # [os           , os_ver, salt_ver, py_ver]
          - [debian       ,   8   ,   2017.7,      2]
          - [ubuntu       ,  16.04,   2017.7,      2]
          - [centos       ,   6   ,   2017.7,      2]
          # - [fedora       ,  30   ,   2017.7,      2]
          # - [opensuse/leap,  15.1 ,   2017.7,      2]
          - [amazonlinux  ,   2   ,   2017.7,      2]
          - [arch-base    , latest,   2017.7,      2]
          - [debian       ,   9   ,   2018.3,      2]
          - [ubuntu       ,  16.04,   2018.3,      2]
          - [centos       ,   7   ,   2018.3,      2]
          # - [opensuse/leap,  15.1 ,   2018.3,      2]
          - [amazonlinux  ,   2   ,   2018.3,      2]
          - [arch-base    , latest,   2018.3,      2]
          # - [fedora       ,  30   ,   2018.3,      3]
          - [ubuntu       ,  18.04,   2019.2,      2]
          - [centos       ,   7   ,   2019.2,      2]
          - [amazonlinux  ,   2   ,   2019.2,      2]
          - [arch-base    , latest,   2019.2,      2]
          - [debian       ,  10   ,   2019.2,      3]
          - [debian       ,   9   ,   2019.2,      3]
          - [ubuntu       ,  18.04,   2019.2,      3]
          - [centos       ,   8   ,   2019.2,      3]
          - [fedora       ,  31   ,   2019.2,      3]
          - [opensuse/leap,  15.1 ,   2019.2,      3]
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          # - [debian       ,   8   ,   2017.7,      2,     v201707-py2]
          - [ubuntu       ,  16.04,   2017.7,      2,     v201707-py2]
          - [centos       ,   6   ,   2017.7,      2,     v201707-py2]
          # # - [fedora       ,  30   ,   2017.7,      2,     v201707-py2]
          # # - [opensuse/leap,  15.1 ,   2017.7,      2,     v201707-py2]
          # - [amazonlinux  ,   2   ,   2017.7,      2,     v201707-py2]
          # # - [arch-base    , latest,   2017.7,      2,       v201707-py2]
          - [debian       ,   9   ,   2018.3,      2,     v201803-py2]
          # - [ubuntu       ,  16.04,   2018.3,      2,     v201803-py2]
          - [centos       ,   7   ,   2018.3,      2,     v201803-py2]
          # # - [opensuse/leap,  15.1 ,   2018.3,      2,     v201803-py2]
          # - [amazonlinux  ,   2   ,   2018.3,      2,     v201803-py2]
          # # - [arch-base    , latest,   2018.3,      2,       v201803-py2]
          - [ubuntu       ,  18.04,   2019.2,      2,     v201902-py2]
          # - [centos       ,   7   ,   2019.2,      2,     v201902-py2]
          - [amazonlinux  ,   2   ,   2019.2,      2,     v201902-py2]
          # # - [arch-base    , latest,   2019.2,      2,       v201902-py2]
          - [debian       ,  10   ,   2019.2,      3,     v201902-py3]
          # - [debian       ,   9   ,   2019.2,      3,     v201902-py3]
          # - [ubuntu       ,  18.04,   2019.2,      3,     v201902-py3]
          # - [centos       ,   8   ,   2019.2,      3,     v201902-py3]
          # # - [fedora       ,  31   ,   2019.2,      3,     v201902-py3]
          - [opensuse/leap,  15.1 ,   2019.2,      3,     v201902-py3]
        use_tofs: true
        yamllint:
          ignore:
            additional:
              - salt/osfamilymap.yaml
              - salt/osmap.yaml
      semrel_files: *semrel_files_default
    ssf:
      context:
        git:
          github:
            owner: 'myii'
            repo: 'ssf-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the ssf formula is setup and configured correctly
        inspec_suites_matrix: []
        platforms: []
        platforms_matrix: []
        rubocop:
          AllCops:
            Exclude:
              - 'ssf/files/**/*'
        use_tofs: true
        yamllint:
          ignore:
            additional:
              - ssf/files/default/.cirrus.yml
              - ssf/files/default/.rubocop.yml
              - ssf/files/default/.salt-lint
              - ssf/files/default/.travis.yml
              - ssf/files/default/.yamllint
              - ssf/files/default/kitchen.yml
              - ssf/files/default/inspec/inspec.yml
              - ssf/files/tofs_ssf-formula/.travis.yml
              - ssf/files/tofs_ssf-formula/.yamllint
          rules:
            commas:
              ignore:
                - ssf/defaults.yaml
                - ssf/formulas.yaml
      semrel_files:
        docs/CONTRIBUTING.rst: *file__docs__CONTRIBUTING--rst
        docs/TOFS_pattern.rst: *file__docs__TOFS_pattern--rst
        formula/libtofs.jinja: *file__formula__libtofs--jinja
        .gitignore: *file__--gitignore
        .rubocop.yml: *file__--rubocop--yml
        .salt-lint: *file__--salt-lint
        .travis.yml: *file__--travis--yml
        .yamllint: *file__--yamllint
        commitlint.config.js: *file__commitlint--config--js
        Gemfile: *file__Gemfile
        pre-commit_semantic-release.sh: *file__pre-commit_semantic-release--sh
        release-rules.js: *file__release-rules--js
        release.config.js: *file__release--config--js
    stack:
      context:
        git:
          github:
            owner: 'claudekenni'
            repo: 'stack-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the stack formula is setup and configured correctly
              supports:
                - debian
                - ubuntu
                - centos
        travis: *travis_do_not_use_single_job_for_linters
        use_tofs: true
      semrel_files:
        docs/TOFS_pattern.rst:
          <<: *file__docs__TOFS_pattern--rst
          dest_file: 'TOFS_pattern.rst'
        formula/libtofs.jinja:
          <<: *file__formula__libtofs--jinja
          dest_file: 'formula/macros.jinja'
        inspec/inspec.yml: *file__inspec__inspec--yml
        inspec/README.md: *file__inspec__README--md
        .gitignore: *file__--gitignore
        Gemfile: *file__Gemfile
    strongswan:
      context:
        git:
          github:
            repo: 'strongswan-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the strongswan formula is setup and configured correctly
        rubocop:
          Cops:
            Metrics/BlockLength:
              Max: 27
        use_tofs: true
      semrel_files: *semrel_files_default
    stunnel:
      context:
        git:
          github:
            repo: 'stunnel-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the stunnel formula is setup and configured correctly
              supports: *supports_debian_ubuntu
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/stunnel.sls'
              state_top:
                - '*':
                    - .pillar_certs
                    - .
        platforms_matrix:
          # Couldn't use `*platforms_matrix_osfamily_debian` because it is
          # currently failing on both `ubuntu-16.04` and `debian-8`
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   master,      3,         default]
          - [debian       ,   9   ,   2019.2,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [debian       ,   9   ,   2018.3,      2,         default]
      semrel_files: *semrel_files_default
    sudoers:
      context:
        git:
          github:
            repo: 'sudoers-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the sudoers formula is setup and configured correctly
            provisioner:
              pillars:
                - '*':
                    - kitchen
                    - .
              pillars_from_files:
                - kitchen.sls: 'test/salt/pillar/kitchen.sls'
                - .sls: 'test/salt/pillar/default.sls'
              state_top:
                - '*':
                    - .
                    - .included
        rubocop:
          Cops:
            Metrics/BlockLength:
              Max: 41
      semrel_files: *semrel_files_default
    sysctl:
      context:
        git:
          github:
            repo: 'sysctl-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the sysctl formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/sysctl.sls'
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [centos       ,   8   ,   2019.2,      3,         default]
          - [fedora       ,  31   ,   2019.2,      3,         default]
          # - [fedora       ,  30   ,   2018.3,      3,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [amazonlinux  ,   2   ,   2018.3,      2,         default]
          # - [centos       ,   6   ,   2017.7,      2,         default]
          - [arch-base    , latest,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    syslog-ng:
      context:
        git:
          github:
            repo: 'syslog-ng-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the syslog_ng formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/syslog_ng.sls'
        travis: *travis_do_not_use_single_job_for_linters
        use_cirrus_ci: true
        use_tofs: true
      semrel_files:
        <<: *semrel_files_default
        formula/libtofs.jinja:
          <<: *file__formula__libtofs--jinja
          alt_semrel_formula: 'syslog_ng'
        inspec/inspec.yml:
          <<: *file__inspec__inspec--yml
          alt_semrel_formula: 'syslog_ng'
        kitchen.yml:
          <<: *file__kitchen--yml
          alt_semrel_formula: 'syslog_ng'
    sysstat:
      context:
        git:
          github:
            repo: 'sysstat-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the sysstat formula is setup and configured correctly
        travis: *travis_do_not_use_single_job_for_linters
        use_tofs: true
      semrel_files: *semrel_files_default
    systemd:
      context:
        git:
          github:
            repo: 'systemd-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the systemd formula is setup and configured correctly
            provisioner:
              state_top:
                - '*':
                    - .
                    - .networkd
                    - .networkd.profiles
                    - .units
        platforms:
          # [os           , os_ver, salt_ver, py_ver]
          - [debian       ,  10   ,   master,      3]
          - [ubuntu       ,  18.04,   master,      3]
          - [centos       ,   8   ,   master,      3]
          - [fedora       ,  31   ,   master,      3]
          - [opensuse/leap,  15.1 ,   master,      3]
          - [amazonlinux  ,   2   ,   master,      2]
          - [arch-base    , latest,   master,      2]
          - [debian       ,   9   ,   2019.2,      3]
          - [ubuntu       ,  18.04,   2019.2,      3]
          - [centos       ,   8   ,   2019.2,      3]
          - [fedora       ,  31   ,   2019.2,      3]
          - [opensuse/leap,  15.1 ,   2019.2,      3]
          - [amazonlinux  ,   2   ,   2019.2,      2]
          - [centos       ,   7   ,   2019.2,      2]  # CHECK
          - [arch-base    , latest,   2019.2,      2]
          - [fedora       ,  30   ,   2018.3,      3]
          - [debian       ,   9   ,   2018.3,      2]
          - [ubuntu       ,  16.04,   2018.3,      2]
          - [centos       ,   7   ,   2018.3,      2]
          - [opensuse/leap,  15.1 ,   2018.3,      2]
          - [amazonlinux  ,   2   ,   2018.3,      2]
          - [arch-base    , latest,   2018.3,      2]
          - [debian       ,   8   ,   2017.7,      2]
          - [ubuntu       ,  16.04,   2017.7,      2]
          # - [centos       ,   6   ,   2017.7,      2]
          - [fedora       ,  30   ,   2017.7,      2]
          - [opensuse/leap,  15.1 ,   2017.7,      2]
          - [amazonlinux  ,   2   ,   2017.7,      2]
          - [arch-base    , latest,   2017.7,      2]
        platforms_matrix: *platforms_matrix_systemd_only
        rubocop:
          Cops:
            Metrics/BlockLength:
              Max: 41
        use_tofs: true
      semrel_files: *semrel_files_default
    telegraf:
      context:
        git:
          github:
            repo: 'telegraf-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the telegraf formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/telegraf.sls'
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [centos       ,   8   ,   2019.2,      3,         default]
          - [fedora       ,  31   ,   2019.2,      3,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [ubuntu       ,  16.04,   2017.7,      2,         default]
        use_tofs: true
      semrel_files: *semrel_files_default
    template:
      context:
        git:
          github:
            repo: 'template-formula'
        inspec_suites_kitchen:
          0:
            excludes: *platforms_os_centos6
            inspec_yml:
              summary: >-
                Verify that the template formula is setup and configured correctly
            provisioner:
              pillars:
                - '*':
                    - .
                    - define_roles
              pillars_from_files:
                - .sls: 'pillar.example'
                - define_roles.sls: 'test/salt/pillar/define_roles.sls'
          1:
            includes: *platforms_os_centos6
            provisioner:
              pillars:
                - '*':
                    - .
                    - define_roles
              pillars_from_files:
                - .sls: 'test/salt/pillar/centos6.sls'
                - define_roles.sls: 'test/salt/pillar/define_roles.sls'
            verifier: *verifier_inspec_tests_default
        inspec_suites_matrix:
          - default
          - centos6
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          - [arch-base    , latest,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         centos6]
        rubocop:
          Cops:
            Metrics/BlockLength:
              Max: 36
        use_tofs: true
      semrel_files: *semrel_files_default
    timezone:
      context:
        git:
          github:
            repo: 'timezone-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the timezone formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/timezone.sls'
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [opensuse/leap,  15.1 ,   2019.2,      3,         default]
          # # - [arch-base    , latest,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [amazonlinux  ,   2   ,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    ufw:
      context:
        git:
          github:
            repo: 'ufw-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the ufw formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [ubuntu       ,  18.04,   master,      3,         default]
          # # - [debian       ,  10   ,   2019.2,      3,         default]
          # # - [centos       ,   8   ,   2019.2,      3,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [arch-base    , latest,   2018.3,      2,         default]
          - [ubuntu       ,  16.04,   2017.7,      2,         default]
        travis:
          <<: *travis_do_not_use_single_job_for_linters
          # Facing errors with `xenial` at time of adding
          # https://travis-ci.org/myii/ufw-formula/jobs/561205378#L906
          # Persisting with `bionic` as well
          # https://travis-ci.org/myii/ufw-formula/jobs/581764920#L807
          dist: 'trusty'
        use_tofs: true
      semrel_files: *semrel_files_default
    users:
      context:
        git:
          github:
            repo: 'users-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the users formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
          1:
            inspec_yml:
              summary: >-
                Verify that the `.vimrc` file is configured correctly for
                specified users
            provisioner:
              dependencies:
                - name: 'vim'
                  repo: 'git'
                  source: 'https://github.com/saltstack-formulas/vim-formula.git'
              pillars:
                - '*':
                    - .
                    - vimrc
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
                - vimrc.sls: 'test/salt/pillar/vimrc.sls'
              state_top:
                - '*':
                    - .vimrc
            verifier:
              inspec_tests:
                - default
                - .
        inspec_suites_matrix:
          - default
          - vimrc
        platforms_matrix:
          # Based on `*platforms_matrix_without_arch`
          - [debian       ,  10   ,   master,      3,           vimrc]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [opensuse/leap,  15.1 ,   2019.2,      3,         default]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          # - [arch-base    , latest,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
        # To deal with excessive instances when mimicking `kitchen list -b`
        # If values are set, only use these as commented entries in the matrix
        platforms_matrix_commented_includes:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   master,      3,         default]
          - [centos       ,   8   ,   master,      3,         default]
          - [fedora       ,  31   ,   master,      3,         default]
          - [opensuse/leap,  15.1 ,   master,      3,         default]
          - [amazonlinux  ,   2   ,   master,      2,         default]
          - [arch-base    , latest,   master,      2,         default]
          - [debian       ,  10   ,   2019.2,      3,         default]
          - [debian       ,   9   ,   2019.2,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [centos       ,   8   ,   2019.2,      3,         default]
          - [fedora       ,  31   ,   2019.2,      3,         default]
          - [opensuse/leap,  15.1 ,   2019.2,      3,         default]
          - [centos       ,   7   ,   2019.2,      2,         default]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          - [arch-base    , latest,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [debian       ,   9   ,   2018.3,      2,         default]
          - [ubuntu       ,  16.04,   2018.3,      2,         default]
          - [centos       ,   7   ,   2018.3,      2,         default]
          - [opensuse/leap,  15.1 ,   2018.3,      2,         default]
          - [amazonlinux  ,   2   ,   2018.3,      2,         default]
          - [arch-base    , latest,   2018.3,      2,         default]
          - [debian       ,   8   ,   2017.7,      2,         default]
          - [ubuntu       ,  16.04,   2017.7,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
          - [fedora       ,  30   ,   2017.7,      2,         default]
          - [opensuse/leap,  15.1 ,   2017.7,      2,         default]
          - [amazonlinux  ,   2   ,   2017.7,      2,         default]
          - [arch-base    , latest,   2017.7,      2,         default]
      semrel_files: *semrel_files_default
    varnish:
      context:
        git:
          github:
            repo: 'varnish-formula'
        inspec_suites_kitchen:
          0:
            excludes: *platforms_osfamily_suse
            inspec_yml:
              summary: >-
                Verify that the varnish formula is setup and configured correctly
            provisioner:
              pillars:
                - '*':
                    - .
                    - default
              pillars_from_files:
                - .sls: 'test/salt/pillar/varnish.sls'
                - default.sls: 'test/salt/pillar/default.sls'
              state_top:
                - '*':
                    - .ng
          1:
            includes: *platforms_osfamily_suse
            provisioner:
              pillars:
                - '*':
                    - .
                    - suse
              pillars_from_files:
                - .sls: 'test/salt/pillar/varnish.sls'
                - suse.sls: 'test/salt/pillar/suse.sls'
              state_top:
                - '*':
                    - .ng
            verifier: *verifier_inspec_tests_default
        inspec_suites_matrix:
          - default
          - suse
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          - [opensuse/leap,  15.1 ,   2019.2,      3,            suse]
          - [amazonlinux  ,   2   ,   2019.2,      2,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [arch-base    , latest,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
      #   # Enable this in a subsequent PR, since it's an old version,
      #   # which is already active (needs to be checked for regressions)
      #   use_tofs: true
      semrel_files: *semrel_files_default
    vault:
      context:
        git:
          github:
            repo: 'vault-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the vault binary is installed correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/install_binary.sls'
              state_top:
                - '*':
                    - .package
          1:
            inspec_yml:
              summary: >-
                Verify that the vault development server is setup and configured
                correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/dev_server.sls'
          2:
            inspec_yml:
              summary: >-
                Verify that the vault production server is setup and configured
                correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/prod_server.sls'
          3: {}
        inspec_suites_matrix:
          # - install_binary
          # - dev_server
          - prod_server
          - ''
        platforms:
          # [os           , os_ver, salt_ver, py_ver]
          - [amazonlinux  ,   1   ,   master,      2]
          - [debian       ,  10   ,   master,      3]
          - [ubuntu       ,  18.04,   master,      3]
          - [centos       ,   8   ,   master,      3]
          - [fedora       ,  31   ,   master,      3]
          - [opensuse/leap,  15.1 ,   master,      3]
          - [amazonlinux  ,   2   ,   master,      2]
          - [arch-base    , latest,   master,      2]
          - [amazonlinux  ,   1   ,   2019.2,      2]
          - [debian       ,  10   ,   2019.2,      3]
          - [debian       ,   9   ,   2019.2,      3]
          - [ubuntu       ,  18.04,   2019.2,      3]
          - [centos       ,   8   ,   2019.2,      3]
          - [fedora       ,  31   ,   2019.2,      3]
          - [opensuse/leap,  15.1 ,   2019.2,      3]
          - [centos       ,   7   ,   2019.2,      2]
          - [amazonlinux  ,   2   ,   2019.2,      2]
          - [arch-base    , latest,   2019.2,      2]
          - [fedora       ,  30   ,   2018.3,      3]
          - [amazonlinux  ,   1   ,   2018.3,      2]
          - [debian       ,   9   ,   2018.3,      2]
          - [ubuntu       ,  16.04,   2018.3,      2]
          - [centos       ,   7   ,   2018.3,      2]
          - [opensuse/leap,  15.1 ,   2018.3,      2]
          - [amazonlinux  ,   2   ,   2018.3,      2]
          - [arch-base    , latest,   2018.3,      2]
          - [amazonlinux  ,   1   ,   2017.7,      2]
          - [debian       ,   8   ,   2017.7,      2]
          - [ubuntu       ,  16.04,   2017.7,      2]
          - [centos       ,   6   ,   2017.7,      2]
          - [fedora       ,  30   ,   2017.7,      2]
          - [opensuse/leap,  15.1 ,   2017.7,      2]
          - [amazonlinux  ,   2   ,   2017.7,      2]
          - [arch-base    , latest,   2017.7,      2]
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,              '']
          - [ubuntu       ,  18.04,   2019.2,      3,     prod_server]
          - [fedora       ,  31   ,   2019.2,      3,     prod_server]
          - [amazonlinux  ,   2   ,   2019.2,      2,     prod_server]
          - [centos       ,   7   ,   2018.3,      2,     prod_server]
          - [opensuse/leap,  15.1 ,   2018.3,      2,     prod_server]
          - [arch-base    , latest,   2017.7,      2,     prod_server]
        # To deal with excessive instances when mimicking `kitchen list -b`
        # If values are set, only use these as commented entries in the matrix
        platforms_matrix_commented_includes:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [amazonlinux  ,   1   ,   master,      2,              '']
          - [ubuntu       ,  18.04,   master,      3,              '']
          - [centos       ,   8   ,   master,      3,              '']
          - [fedora       ,  31   ,   master,      3,              '']
          - [opensuse/leap,  15.1 ,   master,      3,              '']
          - [amazonlinux  ,   2   ,   master,      2,              '']
          - [arch-base    , latest,   master,      2,              '']
          - [amazonlinux  ,   1   ,   2019.2,      2,              '']
          - [debian       ,  10   ,   2019.2,      3,              '']  # CHECK
          - [debian       ,   9   ,   2019.2,      3,              '']
          - [centos       ,   8   ,   2019.2,      3,              '']
          - [opensuse/leap,  15.1 ,   2019.2,      3,              '']
          - [centos       ,   7   ,   2019.2,      2,              '']  # CHECK
          - [arch-base    , latest,   2019.2,      2,              '']
          - [amazonlinux  ,   1   ,   2018.3,      2,              '']
          - [fedora       ,  30   ,   2018.3,      3,              '']
          - [debian       ,   9   ,   2018.3,      2,              '']
          - [ubuntu       ,  16.04,   2018.3,      2,              '']
          - [amazonlinux  ,   2   ,   2018.3,      2,              '']
          - [arch-base    , latest,   2018.3,      2,              '']
          - [amazonlinux  ,   1   ,   2017.7,      2,              '']
          - [debian       ,   8   ,   2017.7,      2,              '']
          - [ubuntu       ,  16.04,   2017.7,      2,              '']
          - [centos       ,   6   ,   2017.7,      2,              '']
          - [fedora       ,  30   ,   2017.7,      2,              '']
          - [opensuse/leap,  15.1 ,   2017.7,      2,              '']
          - [amazonlinux  ,   2   ,   2017.7,      2,              '']
        travis: *travis_do_not_use_single_job_for_linters
      semrel_files: *semrel_files_default
    vim:
      context:
        git:
          github:
            repo: 'vim-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the vim formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/vim.sls'
        platforms_matrix: *platforms_matrix_without_arch
      semrel_files: *semrel_files_default
    vsftpd:
      context:
        git:
          github:
            repo: 'vsftpd-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the vsftpd formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/vsftpd.sls'
      semrel_files: *semrel_files_default
    zabbix:
      context:
        git:
          github:
            repo: 'zabbix-formula'
        inspec_suites_kitchen:
          0:
            inspec_yml:
              summary: >-
                Verify that the zabbix formula is setup and configured correctly
            provisioner:
              pillars_from_files:
                - .sls: 'test/salt/pillar/default.sls'
              state_top:
                - '*':
                    - .agent.repo
                    - .agent.conf
                    - .server.repo
                    - .server.conf
                    - .frontend.repo
                    - .frontend.conf
        platforms_matrix:
          # [os           , os_ver, salt_ver, py_ver,    inspec_suite]
          - [debian       ,  10   ,   master,      3,         default]
          - [debian       ,   9   ,   2019.2,      3,         default]
          - [ubuntu       ,  18.04,   2019.2,      3,         default]
          # - [fedora       ,  31   ,   2019.2,      3,         default]
          - [fedora       ,  30   ,   2018.3,      3,         default]
          - [ubuntu       ,  16.04,   2018.3,      2,         default]
          - [centos       ,   6   ,   2017.7,      2,         default]
        rubocop:
          Cops:
            Metrics/BlockLength:
              Max: 28
        use_tofs: true
        yamllint:
          rules:
            key-duplicates:
              ignore: *ignore_pillar_example
      semrel_files: *semrel_files_default
